name: Repo Sync & Ops

on:
  push:
    branches: [ "main", "master" ]
    paths:
      - 'README.md'
      - 'meta.yaml' # Ažurirano da prati i meta.yaml
      - 'VALTER-INTERNAL/RADNI-NALOZI/**'

jobs:
  # 1. Sinkronizacija Metadataka (Opis, Homepage)
  sync-metadata:
    runs-on: ubuntu-latest
    permissions:
      # ISPRAVAK: 'repository: write' je nevažeći ključ. 'contents: write' je ispravno.
      contents: write
    steps:
      - uses: actions/checkout@v4
      
      - name: Install yq
        run: sudo wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -O /usr/bin/yq && sudo chmod +x /usr/bin/yq

      - name: Update Repo Info from meta.yaml
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 1. Izvuci opis i homepage URL iz meta.yaml
          DESCRIPTION=$(yq e '.description' meta.yaml)
          HOMEPAGE=$(yq e '.homepage' meta.yaml) # Koristimo novo 'homepage' polje
          
          # 3. Ažuriraj GitHub putem CLI-a
          echo "Updating description to: $DESCRIPTION"
          echo "Updating homepage to: $HOMEPAGE"
          gh repo edit --description "$DESCRIPTION" --homepage "$HOMEPAGE" --enable-issues=true --enable-projects=true

  # 2. Sinkronizacija Radnih Naloga (Issues)
  sync-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    steps:
      - uses: actions/checkout@v4
      
      - name: Convert TODOs to Issues
        uses: alstr/todo-to-issue-action@v4
        with:
          CLOSE_ISSUES: "true" # Ako obrišeš TODO, zatvara Issue
          AUTO_ASSIGN: "true"
